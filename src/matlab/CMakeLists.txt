

SET(MEX_NAME nearest_neighbors)
EXECUTE_PROCESS(COMMAND mexext OUTPUT_VARIABLE MEX_EXTENSION OUTPUT_STRIP_TRAILING_WHITESPACE)
# SET(MEX_EXTENSION mexglx)
SET(MEX_COMMAND mex)
SET(MEX_FILE ${CMAKE_CURRENT_BINARY_DIR}/${MEX_NAME}.${MEX_EXTENSION})

ADD_CUSTOM_COMMAND(
    OUTPUT ${MEX_FILE}
    COMMAND ${MEX_COMMAND}
    ARGS ${CMAKE_CURRENT_SOURCE_DIR}/${MEX_NAME}.cc -I${PROJECT_SOURCE_DIR}/cpp -lflann -L${PROJECT_BINARY_DIR}/cpp
    DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/${MEX_NAME}.cc ${PROJECT_BINARY_DIR}/cpp/libflann_s.a
    COMMENT "Building MEX extension ${MEX_FILE}"
)

ADD_CUSTOM_TARGET(mex_${MEX_NAME} ALL DEPENDS ${MEX_FILE})

FILE(GLOB MATLAB_SOURCES *.m)

INSTALL (
FILES ${MEX_FILE} ${MATLAB_SOURCES}
DESTINATION matlab
)

